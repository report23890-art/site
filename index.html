<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Калькулятор прибыли</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
  <h2>Калькулятор прибыли для двоих</h2>

  <label>Игрок 1:</label>
  <input type="number" id="profit1" placeholder="Введите прибыль игрока 1">

  <label>Игрок 2:</label>
  <input type="number" id="profit2" placeholder="Введите прибыль игрока 2">

  <button onclick="saveProfit()">Сохранить</button>

  <div id="result"></div>
  <h3>История</h3>
  <div id="history"></div>
</div>

<script>
const NPOINT_URL = "https://api.npoint.io/3e0972ea646c4d778f85";

async function fetchHistory() {
    const response = await fetch(NPOINT_URL);
    const data = await response.json();
    return data.history || [];
}

async function updateHistory(newHistory) {
    await fetch(NPOINT_URL, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ history: newHistory })
    });
}

async function displayHistory() {
    const historyDiv = document.getElementById('history');
    const history = await fetchHistory();
    if (!history.length) { 
        historyDiv.innerText = "История пуста"; 
        return; 
    }
    let html = "<ul>";
    history.forEach(item => {
        html += `<li>[${new Date(item.created_at).toLocaleString()}] Игрок1: ${item.player1}, Игрок2: ${item.player2}, Всего: ${item.player1 + item.player2}</li>`;
    });
    html += "</ul>";
    historyDiv.innerHTML = html;
}

async function saveProfit() {
    const profit1 = parseFloat(document.getElementById('profit1').value);
    const profit2 = parseFloat(document.getElementById('profit2').value);
    if(isNaN(profit1) || isNaN(profit2)){
        alert("Введите корректные числа!");
        return;
    }
    const history = await fetchHistory();
    const newRecord = { player1: profit1, player2: profit2, created_at: new Date().toISOString() };
    history.push(newRecord);
    await updateHistory(history);
    document.getElementById('result').innerHTML = `Игрок1: ${profit1}, Игрок2: ${profit2}, Всего: ${profit1+profit2}`;
    displayHistory();
}

window.onload = displayHistory;
</script>
</body>
</html>
